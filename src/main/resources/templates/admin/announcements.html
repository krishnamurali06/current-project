<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Announcements</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/app.css}" />
    <link rel="stylesheet" th:href="@{/css/dashboard.css}" />
</head>
<body>
    <div th:replace="~{shared/header :: header}"></div>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2><i class="fas fa-bullhorn me-2"></i>Announcements</h2>
                        <p class="text-muted">Create and manage system-wide announcements</p>
                    </div>
                    <div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createAnnouncementModal">
                            <i class="fas fa-plus me-2"></i>Create Announcement
                        </button>
                    </div>
                </div>

                <!-- Success/Error Messages -->
                <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <span th:text="${success}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Active Announcements -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Active Announcements</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="alert alert-info">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="alert-heading">System Maintenance Scheduled</h6>
                                            <p class="mb-0">We will be performing scheduled maintenance on Sunday, 2:00 AM - 4:00 AM EST. The system may be temporarily unavailable during this time.</p>
                                            <small class="text-muted">Posted: 2025-01-15 10:30 AM</small>
                                        </div>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editAnnouncementModal">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="confirmDelete(1)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-success">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="alert-heading">New Features Available</h6>
                                            <p class="mb-0">We've added new crop management features and improved the marketplace interface. Check out the latest updates!</p>
                                            <small class="text-muted">Posted: 2025-01-14 3:45 PM</small>
                                        </div>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editAnnouncementModal">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="confirmDelete(2)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="alert alert-warning">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="alert-heading">Weather Alert</h6>
                                            <p class="mb-0">Heavy rainfall expected in the northern regions. Farmers are advised to take necessary precautions for their crops.</p>
                                            <small class="text-muted">Posted: 2025-01-13 8:15 AM</small>
                                        </div>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editAnnouncementModal">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="confirmDelete(3)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-primary">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="alert-heading">Marketplace Update</h6>
                                            <p class="mb-0">New pricing guidelines have been implemented. Please review the updated terms and conditions.</p>
                                            <small class="text-muted">Posted: 2025-01-12 2:20 PM</small>
                                        </div>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editAnnouncementModal">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="confirmDelete(4)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Announcement Templates -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Announcement Templates</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-tools fa-2x text-primary mb-3"></i>
                                        <h6>Maintenance Notice</h6>
                                        <p class="text-muted small">Template for system maintenance announcements</p>
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate('maintenance')">
                                            Use Template
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-star fa-2x text-success mb-3"></i>
                                        <h6>Feature Update</h6>
                                        <p class="text-muted small">Template for new feature announcements</p>
                                        <button class="btn btn-outline-success btn-sm" onclick="useTemplate('feature')">
                                            Use Template
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-warning">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                                        <h6>Weather Alert</h6>
                                        <p class="text-muted small">Template for weather-related announcements</p>
                                        <button class="btn btn-outline-warning btn-sm" onclick="useTemplate('weather')">
                                            Use Template
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div class="modal fade" id="createAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Create New Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form th:action="@{/admin/announcements}" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Announcement Type</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select Type</option>
                                <option value="info">Information</option>
                                <option value="warning">Warning</option>
                                <option value="success">Success</option>
                                <option value="danger">Urgent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" name="title" required placeholder="Enter announcement title...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content</label>
                            <textarea class="form-control" name="content" rows="5" required placeholder="Enter announcement content..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" name="priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Audience</label>
                                    <select class="form-select" name="audience">
                                        <option value="all">All Users</option>
                                        <option value="farmers">Farmers Only</option>
                                        <option value="buyers">Buyers Only</option>
                                        <option value="admins">Admins Only</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="sendEmail" id="sendEmail">
                                <label class="form-check-label" for="sendEmail">
                                    Send email notification to target audience
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Announcement</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Announcement Modal -->
    <div class="modal fade" id="editAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Announcement Type</label>
                            <select class="form-select" name="type">
                                <option value="info">Information</option>
                                <option value="warning">Warning</option>
                                <option value="success">Success</option>
                                <option value="danger">Urgent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" name="title" value="System Maintenance Scheduled">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content</label>
                            <textarea class="form-control" name="content" rows="5">We will be performing scheduled maintenance on Sunday, 2:00 AM - 4:00 AM EST. The system may be temporarily unavailable during this time.</textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" name="priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Audience</label>
                                    <select class="form-select" name="audience">
                                        <option value="all" selected>All Users</option>
                                        <option value="farmers">Farmers Only</option>
                                        <option value="buyers">Buyers Only</option>
                                        <option value="admins">Admins Only</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Update Announcement</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div th:replace="~{shared/footer :: footer}"></div>

    <script>
        function useTemplate(templateType) {
            const modal = new bootstrap.Modal(document.getElementById('createAnnouncementModal'));
            const titleInput = document.querySelector('#createAnnouncementModal input[name="title"]');
            const contentInput = document.querySelector('#createAnnouncementModal textarea[name="content"]');
            const typeSelect = document.querySelector('#createAnnouncementModal select[name="type"]');
            
            let title, content, type;
            
            switch(templateType) {
                case 'maintenance':
                    title = 'System Maintenance Scheduled';
                    content = 'We will be performing scheduled maintenance on [DATE] from [START_TIME] to [END_TIME]. The system may be temporarily unavailable during this time. We apologize for any inconvenience.';
                    type = 'info';
                    break;
                case 'feature':
                    title = 'New Features Available';
                    content = 'We\'re excited to announce new features and improvements to the Smart Agriculture platform! [DESCRIBE_FEATURES]. Please check out the latest updates and let us know your feedback.';
                    type = 'success';
                    break;
                case 'weather':
                    title = 'Weather Alert';
                    content = 'Weather alert for [REGION]: [WEATHER_CONDITION] is expected. Farmers are advised to take necessary precautions for their crops and livestock. Stay safe!';
                    type = 'warning';
                    break;
            }
            
            titleInput.value = title;
            contentInput.value = content;
            typeSelect.value = type;
            
            modal.show();
        }
        
        function confirmDelete(announcementId) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                // Here you would make an AJAX call to delete the announcement
                console.log('Deleting announcement:', announcementId);
                // For now, just show a success message
                alert('Announcement deleted successfully!');
            }
        }
    </script>
</body>
</html>
